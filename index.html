<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Flow Ramadan Card</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#07111f;
  font-family:"Noto Kufi Arabic", sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:22px 14px;
  color:#fff;
}

.control{
  width: 760px;
  max-width:100%;
  display:flex;
  gap:10px;
  align-items:center;
  margin-bottom:14px;
}

input{
  flex:1;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.08);
  color:#fff;
  font-family:"Noto Kufi Arabic", sans-serif;
  font-size:10px;
  outline:none;
}

button{
  padding:12px 16px;
  border:none;
  border-radius:12px;
  background:#0ea5e9;
  color:#fff;
  font-weight:700;
  cursor:pointer;
  font-family:"Noto Kufi Arabic", sans-serif;
  white-space:nowrap;
}

button:disabled{
  opacity:.6;
  cursor:not-allowed;
}

.note{
  width: 760px;
  max-width:100%;
  font-size:12px;
  opacity:.85;
  margin: 6px 0 14px;
  line-height:1.6;
}

.card{
  width: 760px;
  max-width:100%;
  border-radius:22px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 48px rgba(0,0,0,.35);
}

#exportArea{
  position:relative;
  width:100%;
  aspect-ratio: 1/1; /* your design is square */
  background:#0a1220;
}

.bg{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* Draggable name (NO background) */
#nameText{
  position:absolute;
  left: 50%;   /* default center */
  top: 55%;
  transform: translate(-50%, -50%);
  font-size: 30px;
  font-weight: 700;
  color: #fff;
  text-shadow: 0 10px 28px rgba(0,0,0,.45);
  white-space: nowrap;
  cursor: grab;
  user-select: none;
  touch-action: none;
}

#nameText:active{ cursor: grabbing; }

/* Small helper badge */
.badge{
  position:absolute;
  right:14px;
  bottom:14px;
  font-size:12px;
  padding:8px 10px;
  border-radius:12px;
  background:rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.14);
  backdrop-filter: blur(8px);
}
</style>
</head>

<body>

<div class="control">
  <button id="downloadBtn" type="button">Download</button>
  <input id="nameInput" type="text" placeholder="Your name" value="your name">
</div>

<div class="note">
   حرّك الاسم  <br>
  Drag name

</div>

<div class="card">
  <div id="exportArea">
    <!-- Put image in same folder as this HTML file -->
    <img id="bgImg" class="bg" src="Ramdan KAREEM.jpg" alt="Ramadan Card">
    <div id="nameText">Your name here</div>
    </div>
</div>

<!-- html2canvas (download as PNG) -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
const nameInput = document.getElementById("nameInput");
const nameText  = document.getElementById("nameText");
const exportArea = document.getElementById("exportArea");
const downloadBtn = document.getElementById("downloadBtn");

const POS_KEY = "flow_ramadan_name_pos_v1";

/* 1) Live name update */
nameInput.addEventListener("input", () => {
  nameText.textContent = nameInput.value.trim() || " ";
});

/* 2) Restore saved position */
(function restorePos(){
  try{
    const saved = JSON.parse(localStorage.getItem(POS_KEY) || "null");
    if(saved && typeof saved.x === "number" && typeof saved.y === "number"){
      nameText.style.left = saved.x + "px";
      nameText.style.top  = saved.y + "px";
      nameText.style.transform = "translate(0,0)";
    }
  }catch(e){}
})();

/* 3) Drag to position (mouse + touch) */
let dragging = false;
let offsetX = 0, offsetY = 0;

function pointerDown(e){
  dragging = true;
  nameText.setPointerCapture(e.pointerId);
  const rect = nameText.getBoundingClientRect();
  offsetX = e.clientX - rect.left;
  offsetY = e.clientY - rect.top;
}

function pointerMove(e){
  if(!dragging) return;

  const areaRect = exportArea.getBoundingClientRect();

  let x = e.clientX - areaRect.left - offsetX;
  let y = e.clientY - areaRect.top  - offsetY;

  // keep inside area (simple clamp)
  x = Math.max(0, Math.min(x, areaRect.width  - nameText.offsetWidth));
  y = Math.max(0, Math.min(y, areaRect.height - nameText.offsetHeight));

  nameText.style.left = x + "px";
  nameText.style.top  = y + "px";
  nameText.style.transform = "translate(0,0)";
}

function pointerUp(e){
  if(!dragging) return;
  dragging = false;

  // save position
  const x = parseFloat(nameText.style.left) || 0;
  const y = parseFloat(nameText.style.top)  || 0;
  localStorage.setItem(POS_KEY, JSON.stringify({x,y}));
}

nameText.addEventListener("pointerdown", pointerDown);
window.addEventListener("pointermove", pointerMove);
window.addEventListener("pointerup", pointerUp);

/* 4) Download PNG */
async function downloadCard(){
  try{
    downloadBtn.disabled = true;
    await document.fonts.ready;

    if(typeof html2canvas !== "function"){
      alert("Download library didn't load. Please open the file with internet (Chrome) or host it on SharePoint/OneDrive.");
      downloadBtn.disabled = false;
      return;
    }

    const canvas = await html2canvas(exportArea, {
      scale: 2,
      backgroundColor: null,
      useCORS: true,
      allowTaint: true
    });

    const a = document.createElement("a");
    const safeName = (nameInput.value.trim() || "employee")
      .replace(/[\\/:*?"<>|]/g, "")
      .replace(/\s+/g, "_");

    a.download = `Flow_Ramadan_${safeName}.png`;
    a.href = canvas.toDataURL("image/png");
    a.click();
  } catch (err){
    alert("Download failed. If you're opening the HTML locally, try hosting it (SharePoint/OneDrive) or ensure internet is available.");
  } finally{
    downloadBtn.disabled = false;
  }
}

downloadBtn.addEventListener("click", downloadCard);
</script>

</body>
</html>





